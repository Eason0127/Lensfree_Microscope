<head>
  <script async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true  // ÂÖÅËÆ∏ `$...$` Ëß£Êûê
      },
      svg: {
        scale: 1.2
      }
    };

    document.addEventListener("DOMContentLoaded", function() {
      MathJax.typesetPromise();
    });
  </script>
</head>

- [Under-sampling simulation](#under-sampling-simulation)
  - [Sample introduction](#sample-introduction)
  - [Noise considered](#noise-considered)
  - [Shannon sampling criteria](#shannon-sampling-criteria)
  - [Simulation method](#simulation-method)
  - [Sample with amplitude and phase absorption](#sample-with-amplitude-and-phase-absorption)
    - [Test without noise](#test-without-noise)
    - [Test with noise(1%) 10000 photons](#test-with-noise1-10000-photons)
    - [Test with noise(4%) 1000 photons](#test-with-noise4-1000-photons)
    - [Test with noise(15%) 100 photons](#test-with-noise15-100-photons)
    - [Test with noise(20%) 64 photons](#test-with-noise20-64-photons)
    - [Test with noise(30%) 36 photons](#test-with-noise30-36-photons)



# Under-sampling simulation


## Sample introduction

It is a random generated sample with $1024 \times 1024$ resolution. I added some white Guassian noise to simulate the random noise while imaging. Due to in lensless microscope the FOV is equal to the active area on the sensor chip which is nearly equal to the size of the sample. So the **FOV** here is $204.8\mu m \times 204.8\mu m$ .

<div align="center">
    <figure>
        <img src="./under_sampling_pic/microscopic_sample_no_grid.png" width="400">
    </figure>
</div>



## Noise considered

In our set up, we will mainly have this four noise below:

Noise|Characteristic
---|---
Thermal noise|White noise
shot noise|White noise
Readout noise|Broadband noise
Dark current noise|Poisson distribution

1. **Thermal noise**
   
   It is caused by the random thermal motion of free electrons in the resistor element under the action of temperature. It can be described by Gaussian distribution $N(0,\sigma ^2)$ .

   $$\sigma = \sqrt{4k_bTRB}$$

2. **Shot noise**
   
   For example for LED or laser, the photons are generated by the energy level transition and this photon emission is random and in a short time it can be described by Poisson distribution.

   $$P(k)=\frac{\lambda^ke^{-\lambda}}{k!}$$

   $k$ is the number of photons that actually arrive, $\lambda$ is the number of photons that is expected to arrive. 
  
   This means that within a fixed exposure time, there will always be statistical fluctuations in the number of photons actually detected, and this fluctuation appears as noise. 

   This noice will become more prominent or dominant when the set up is under low light condition and short exposure time.

> We can find parameters from this https://www.strollswithmydog.com/pi-hq-cam-sensor-performance/#more-4297

1. **Dark noise**
   
   It mainly comes from the carriers generated by thermal motion in semiconductor materials. Even in completely dark conditions, the sensor will detect a certain number of electrons.

   When under low light condition, it can be described by Poisson distribution while when we have large enough expected photon numbers, it can be described by Guassian distribution.

2. **Readout noise**
   
   Readout noise is from the electronic circuits inside and outside the sensor when transform the analog signal to digital signal. It will always exist at a fixed level. It can be also described by Guassian distribution.Under high light conditions, read noise is often no longer the dominant noise source

## Shannon sampling criteria

If we want to recover the signal without any loss we must obey the Shannon sampling criteria, so we can have the minimum sampling distance by as follows: 

$$K_{max}=\frac{2\pi}{\lambda_{min}}\rightarrow f_{max}=\frac{k_{max}}{2\pi}=\frac{1}{\lambda}\rightarrow \Delta x \leq \frac{\lambda_{min}}{2}$$

I assume we use the light of wavelength at $532nm$, so we can get **the minimum sampling distance** $\Delta x = 0.266 \mu m$ 

## Simulation method

I wanted to test the IPR reconstruction with the same sample under different pixel sizes but there would be a **difficulty** for code simulation.

    def angular_spectrum_method(field, pixelSize, distance, W, H, numPixels):
        GT = fftshift(fft2(ifftshift(field)))    ## The matrix size is 1024*1024
        transfer = Transfer_function(W, H, distance, 532e-9, pixelSize, numPixels)  ## The matrix size is 52*52
        transfer = resize_transfer_function(transfer, field.shape)
        gt_prime = fftshift(ifft2(ifftshift(GT * transfer)))  ## The matrix size is different so will cause error
        return gt_prime

<div style="display: flex; justify-content: center; align-items: center;">
    <figure style="margin: 10px; text-align: center;">
        <img src="./under_sampling_pic/ËØ¥ÊòéÂõæ1.png" width="600">
    </figure>
    <span style="font-size: 40px; margin: 10px;">&harr;</span>
    <figure style="margin: 10px; text-align: center;">
        <img src="./under_sampling_pic/ËØ¥ÊòéÂõæ2.png" width="600">
    </figure>
</div>

## Sample with amplitude and phase absorption

The sample has an amplitude absorption $e^{-1.6 \times \text{grayscale value}}$ which means 80% absorption and has a phase modulation index 3 which can modulate the phase by $e^{i\times 3}$

### Test without noise

**1. Ideal case with $0.2 \mu m$ pixel size**

$$
\begin{array}{c|c}
\textbf{RMS} & \textbf{SSIM} \\
\hline
0.1472 & 0.7084
\end{array}
$$

$$\text{RMS}=\sqrt{\frac{1}{n}\sum _{i=1}^n(\text{Reconstructed amp}_{i}-\text{Recorded amp}_i)^2}$$

, $i$ is the pixel index.

<div align="center">
    <figure>
        <img src="./under_sampling_pic/Figure_11.png" width="500">
        <figcaption>Figure 1.1: Sample reconstructed</figcaption>
    </figure>
</div>


**2. Under-sampling with $0.8 \mu m$ pixel size**

$$
\begin{array}{c|c}
\textbf{RMS} & \textbf{SSIM} \\
\hline
0.1726 & 0.5254
\end{array}
$$

<div align="center">
    <figure>
        <img src="./under_sampling_pic/Figure_22.png" width="500">
        <figcaption>Figure 2.1: Sample reconstructed</figcaption>
    </figure>
</div>



üö©**3. Under-sampling with $1.6 \mu m$ pixel size** (If we use IMX477 then this is the circumstance)

$$
\begin{array}{c|c}
\textbf{RMS} & \textbf{SSIM} \\
\hline
0.1811 & 0.5152
\end{array}
$$

<div align="center">
    <figure>
        <img src="./under_sampling_pic/Figure_33.png" width="500">
        <figcaption>Figure 3.1: Sample reconstructed</figcaption>
    </figure>
</div>


**4. Under-sampling with $2.4 \mu m$ pixel size**

$$
\begin{array}{c|c}
\textbf{RMS} & \textbf{SSIM} \\
\hline
0.1713 & 0.5140
\end{array}
$$

<div align="center">
    <figure>
        <img src="./under_sampling_pic/Figure_44.png" width="500">
        <figcaption>Figure 4.1: Sample reconstructed</figcaption>
    </figure>
</div>

### Test with noise(1%) 10000 photons

Noise|Parameter
---|---
Thermal noise|$1e^-$
Readout noise|$3e^-$
shot noise|~$320e^-$(Assume the ideal photon number is $1e5 $ per pixel)

> For shot noise it's noise level is the root of photon number.

1. **Without under-sampling with $0.2 \mu m$ pixel size**
   
   $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1473 & 0.7084
    \end{array}
    $$
   
    <div style="display: flex; justify-content: center; align-items: center;">
        <figure style="margin: 10px; text-align: center;">
            <img src="./under_sampling_pic/Figure_11N.png" width="600">
        </figure>
    </div>

2. **Under-sampling with $0.8 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1727 & 0.5256
    \end{array}
    $$

    <div style="display: flex; justify-content: center; align-items: center;">
        <figure style="margin: 10px; text-align: center;">
            <img src="./under_sampling_pic/Figure_22N.png" width="600">
        </figure>
    </div>
   
3. **Under-sampling with $1.6 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1812  & 0.5152
    \end{array}
    $$

    <div style="display: flex; justify-content: center; align-items: center;">
        <figure style="margin: 10px; text-align: center;">
            <img src="./under_sampling_pic/Figure_33N.png" width="600">
        </figure>
    </div>
   
4. **Under-sampling with $2.4 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1714 & 0.5137
    \end{array}
    $$

    <div style="display: flex; justify-content: center; align-items: center;">
        <figure style="margin: 10px; text-align: center;">
            <img src="./under_sampling_pic/Figure_44N.png" width="600">
        </figure>
    </div>


### Test with noise(4%) 1000 photons


1. **Without under-sampling with $0.2 \mu m$ pixel size**
   
   $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1479 & 0.7063
    \end{array}
    $$
   


2. **Under-sampling with $0.8 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1730 & 0.5238
    \end{array}
    $$


   
3. **Under-sampling with $1.6 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1814  & 0.5130
    \end{array}
    $$

 
   
4. **Under-sampling with $2.4 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1717 & 0.5141
    \end{array}
    $$

### Test with noise(15%) 100 photons


1. **Without under-sampling with $0.2 \mu m$ pixel size**
   
   $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1560 & 0.6781
    \end{array}
    $$
   


2. **Under-sampling with $0.8 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1782 & 0.5079
    \end{array}
    $$


   
3. **Under-sampling with $1.6 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1864  & 0.4977
    \end{array}
    $$

 
   
4. **Under-sampling with $2.4 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1763 & 0.4969
    \end{array}
    $$

 
### Test with noise(20%) 64 photons


1. **Without under-sampling with $0.2 \mu m$ pixel size**
   
   $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1627 & 0.6573
    \end{array}
    $$
   


2. **Under-sampling with $0.8 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1824 & 0.4954
    \end{array}
    $$


   
3. **Under-sampling with $1.6 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1904  & 0.4883
    \end{array}
    $$

 
   
4. **Under-sampling with $2.4 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1812 & 0.4823
    \end{array}
    $$

 ### Test with noise(30%) 36 photons


1. **Without under-sampling with $0.2 \mu m$ pixel size**
   
   $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1627 & 0.6573
    \end{array}
    $$
   


2. **Under-sampling with $0.8 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1824 & 0.4954
    \end{array}
    $$


   
3. **Under-sampling with $1.6 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1904  & 0.4883
    \end{array}
    $$

 
   
4. **Under-sampling with $2.4 \mu m$ pixel size**
   
    $$
    \begin{array}{c|c}
    \textbf{RMS} & \textbf{SSIM} \\
    \hline
    0.1812 & 0.4823
    \end{array}
    $$

 

